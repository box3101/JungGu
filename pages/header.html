<div class="headerWrap">
  <div class="headerInner">
    <h1 class="logo">
      <a href="#">
        <img src="../front/img/logo.png" alt="인천중구교육포털 배우는바다">
      </a>
    </h1>
    <ul class="gnb" id="gnb" tabindex="0">
      <li class="gnbItem" data-img="../front/img/logo.png">
        <a href="#" class="gnbLink">
          평생학습도시
        </a>
        <ul class="subPanel">
          <li>
            <a href="#">인사말</a>
          </li>
          <li>
            <a href="#">비전과 목표</a>
          </li>
          <li>
            <a href="#">선언문</a>
          </li>
          <li>
            <a href="#">조례</a>
          </li>
          <li>
            <a href="#">주요사업 소개</a>
          </li>
          <li>
            <a href="#">높이테스트</a>
          </li>
        </ul>
      </li>
      <li class="gnbItem" data-img="../front/img/logo2.png">
        <a href="#" class="gnbLink">
          수강신청 </a>
        <ul class="subPanel">
          <li>
            <a href="#">평생학습관</a>
          </li>
          <li>
            <a href="#">동행정복지센터</a>
          </li>
          <li>
            <a href="#">문화센터</a>
          </li>
          <li>
            <a href="#">온라인 학습</a>
          </li>
          <li>
            <a href="#">중구구민대학</a>
          </li>
        </ul>
      </li>
      <li class="gnbItem" data-img="../front/img/logo.png">
        <a href="#" class="gnbLink">
          네트워크
        </a>
        <ul class="subPanel">
          <li>
            <a href="#">평생학습기관</a>
          </li>
          <li>
            <a href="#">평생학습 동아리</a>
          </li>
          <li>
            <a href="#">우리동네강사</a>
          </li>
          <li>
            <a href="#">찾아가는 학습</a>
          </li>
        </ul>
      </li>
      <li class="gnbItem" data-img="../front/img/logo2.png">
        <a href="#" class="gnbLink">
          나눔공간
        </a>
        <ul class="subPanel">
          <li>
            <a href="#">대관 안내</a>
          </li>
          <li>
            <a href="#">대관 신청</a>
          </li>
          <li>
            <a href="#">나눔공간</a>
          </li>
        </ul>
      </li>
      <li class="gnbItem" data-img="../front/img/logo.png">
        <a href="#" class="gnbLink">
          열린마당
        </a>
        <ul class="subPanel">
          <li>
            <a href="#">공지사항</a>
          </li>
          <li>
            <a href="#">공모사업 신청</a>
          </li>
          <li>
            <a href="#">자료실</a>
          </li>
        </ul>
      </li>
      <li class="gnbItem" data-img="../front/img/logo2.png">
        <a href="#" class="gnbLink">
          교육혁신지구
        </a>
        <ul class="subPanel">
          <li>
            <a href="#">구석구석 탐방</a>
          </li>
          <li>
            <a href="#">중구마을학교</a>
          </li>
          <li>
            <a href="#">마을교육활동가</a>
          </li>
          <li>
            <a href="#">교육경비 지원사업</a>
          </li>
        </ul>
      </li>
    </ul>
    <ul class="utilMenu">
      <li>
        <button type="button" class="searchBtn">
          <span class="hidden">검색</span>
        </button>
      </li>
      <li>
        <button type="button" class="myPage">
          <span class="hidden">마이페이지</span>
        </button>
      </li>
    </ul>
  </div>
</div>
<div class="headerBg">
  <div class="inner">
    <div class="changImg">
    </div>
  </div>
</div>

<script>

  window.onload = function () {
    (function (e) {
      const $header = document.querySelector(".header");
      const $headerWrap = document.querySelector(".headerWrap");
      const $$gnbLink = document.querySelectorAll(".gnbLink");
      const $headerBg = document.querySelector(".headerBg");
      const $$subPanel = document.querySelectorAll(".subPanel");
      const $visual = document.querySelector(".visual");
      const $logo = document.querySelector(".logo");
      const activeName = "on";
      const $gnb = document.querySelector(".gnb");
      const links = $gnb.querySelectorAll('a');
      const subPenelHeight = [];
      let maxHeight = '';


      // Gnb 최대 높이 설정 함수
      const gnbMaxHeight = (e) => {
        // panel height 높이 설정
        $$subPanel.forEach((el, idx) => {
          let panelHeight = el.clientHeight;
          subPenelHeight.push(panelHeight);
          maxHeight = Math.max(maxHeight, subPenelHeight[idx]);
          el.style.height = maxHeight.toString() + `px`;
          return maxHeight;
        });
        $headerBg.style.height = `${maxHeight + 0}px`;
      }

      // Gnb 오픈 함수
      const gnbOpen = (e) => {
        const target = e.target;

        $$gnbLink.forEach((el) => {
          if (target == el) {
            $headerWrap.classList.add(activeName);
            $headerBg.classList.add(activeName);
            gnbMaxHeight(e);
          }
        });
      }

      // Gnb 닫는 함수
      const gnbClose = () => {
        $headerBg.classList.remove(activeName);
        $headerWrap.classList.remove(activeName);
      }

      // 탭키 접근성
      const tabKey = (e) => {
        if (event.key === 'Tab') {
          $headerWrap.classList.add(activeName);
          $headerBg.classList.add(activeName);
          gnbMaxHeight(e);

          // 탭 키가 눌렸을 때, 현재 포커스가 있는 링크의 인덱스
          const focusedIndex = Array.from(links).indexOf(event.target);

          // 탭키가 처음 마지막 키 눌렀을때
          if (focusedIndex === -1 || focusedIndex === links.length - 1) {
            $headerBg.classList.remove(activeName);
            $headerWrap.classList.remove(activeName);
            return;
          }
        }
      }

      // Gnb 활성화
      const subPanelActive = (e) => {
        $$subPanel.forEach((el, idx) => {
          el.addEventListener("mouseover", (e) => {
            el.previousElementSibling.classList.add("on");
          });
          el.addEventListener("mouseout", (e) => {
            el.previousElementSibling.classList.remove("on");
          });
        });
      }

      // gnbItem li 활성화
      const changeImgAtive = (e) => {
        const target = e.target;
        const $changeImg = document.querySelector(".changImg");
        const $$gnbItem = document.querySelectorAll(".gnbItem");
        const $$subPanelItem = document.querySelectorAll(".subPanel a");

        // 배경 이미지 활성화 함수
        const changImgActive = (el) => {
          let changeImg = el.closest(".gnbItem").getAttribute("data-img");
          $changeImg.style.backgroundImage = `url(${changeImg})`;
        }

        $$gnbItem.forEach((el) => {
          if (target == el || target == el.querySelector(".subPanel")) {
            changImgActive(el);
          }
        });
        $$subPanelItem.forEach((el) => {
          if (target == el) {
            changImgActive(el);
          }
        });
      }

      $header.addEventListener("mouseover", gnbOpen);
      $visual.addEventListener("mouseover", gnbClose);
      $gnb.addEventListener('keydown', tabKey);
      $gnb.addEventListener('keydown', subPanelActive(e));
      $gnb.addEventListener('mouseover', changeImgAtive);

    })();
  }

</script>